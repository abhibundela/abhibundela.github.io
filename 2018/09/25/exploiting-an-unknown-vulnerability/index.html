<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exploiting an unknown vulnerability - Learn Build &amp; Break!</title>
<meta name="author" content="Abhishek Bundela">
<meta name="description" content="">

<meta name="generator" content="Hugo 0.47.1" />


<link href="//fonts.googleapis.com/css?family=Roboto:400" rel="stylesheet">
<link rel="stylesheet" href='/assets/css/main.39ec5efb65b7.css'>


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/img/apple-touch-icon.png">
<link rel="shortcut icon" href="/assets/img/favicon.ico">


<link href="/posts/index.xml" rel="alternate" type="application/rss+xml" title="Learn Build &amp; Break!" />
<link href="/posts/index.xml" rel="feed" type="application/rss+xml" title="Learn Build &amp; Break!" />

<meta property="og:title" content="Exploiting an unknown vulnerability" />
<meta property="og:description" content="I found this vulnerability around 2 months ago in a consulting application. Their security team told me this application is already pentested and they will reward bonus if I could find a vulnerability. For new targets, first I analyze application and make a data flow diagram of its functionality then I start hunting for vulnerabilities. I extensively test for logical vulnerabilities because I know from my experience that there will be some critical transitions which might have been missed by application developers or testers." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://abhibundela.com/2018/09/25/exploiting-an-unknown-vulnerability/" /><meta property="article:published_time" content="2018-09-25T05:30:21-07:00"/>
<meta property="article:modified_time" content="2018-09-25T05:30:21-07:00"/>


<meta itemprop="name" content="Exploiting an unknown vulnerability">
<meta itemprop="description" content="I found this vulnerability around 2 months ago in a consulting application. Their security team told me this application is already pentested and they will reward bonus if I could find a vulnerability. For new targets, first I analyze application and make a data flow diagram of its functionality then I start hunting for vulnerabilities. I extensively test for logical vulnerabilities because I know from my experience that there will be some critical transitions which might have been missed by application developers or testers.">


<meta itemprop="datePublished" content="2018-09-25T05:30:21-07:00" />
<meta itemprop="dateModified" content="2018-09-25T05:30:21-07:00" />
<meta itemprop="wordCount" content="747">



<meta itemprop="keywords" content="bugbounty,Race conditon," />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Exploiting an unknown vulnerability"/>
<meta name="twitter:description" content="I found this vulnerability around 2 months ago in a consulting application. Their security team told me this application is already pentested and they will reward bonus if I could find a vulnerability. For new targets, first I analyze application and make a data flow diagram of its functionality then I start hunting for vulnerabilities. I extensively test for logical vulnerabilities because I know from my experience that there will be some critical transitions which might have been missed by application developers or testers."/>


  </head>
  <body>
    <nav>
  <a href="/" title="Homepage">
    Home
  </a>
  
    <a class="homePageIcon" href="/" title="Homepage">
      <svg fill="#000000" height="48" viewBox="0 0 24 24" width="48" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        <path d="M0 0h24v24H0z" fill="none"/>
      </svg>
    </a>
  
</nav>

    <main>
      
  <div class="progress-container">
    <div class="progress-bar"></div>
  </div>
  <article>
    <header>
      <time datetime="2018-09-25 05:30">2018-09-25</time>
      <h1>Exploiting an unknown vulnerability</h1>
    </header>
    <section>

<p>I found this vulnerability around 2 months ago in a consulting application. Their security team told me this application is already pentested and they will reward bonus if I could find a vulnerability. For new targets, first I analyze application and make a data flow diagram of its functionality then I start hunting for vulnerabilities. I extensively test for logical vulnerabilities because I know from my experience that there will be some critical transitions which might have been missed by application developers or testers.</p>

<p>I have named it as &ldquo;unknown&rdquo;   vulnerability because I want to make it as an exercise as well as write up that&rsquo;s why I haven&rsquo;t written details in the title.</p>

<p>There are two types of user roles: consultant and client in target application. The application&rsquo;s core functionality is to provide consulting services to various clients.</p>

<ol>
<li>Consultant set fee in coins for their service.</li>
</ol>

<pre><code># consultant request

POST /set/fee/
{&quot;value&quot;: 5, &quot;timing&quot;:2}
</code></pre>

<ol>
<li>Clients visits consultant&rsquo;s timeline, select an appropriate time slot and book that timing, coins get deducted from client&rsquo;s account according to fee shown in timeline respective to time slot.</li>
</ol>

<pre><code># client request

POST /consultant_username/book
{&quot;timing&quot;:2}
</code></pre>

<p>Before reading further, I will suggest you guys to write your test case or your approach to exploit the above functionality. Good luck  üëç</p>

<p><img src="https://cdn-images-1.medium.com/max/1320/1*KYxxMeg9CDzX_NLhCap3Sw.jpeg" alt="..." /></p>

<p>I came up with following test cases ü§î.</p>

<ol>
<li>Injection vulnerability like Sqli, Command injection</li>
<li>Modify content type and request data to xml for testing XML injection</li>
<li>Booking consultant&rsquo;s higher value time slots in less coin</li>
<li>Injecting &ldquo;<strong>value</strong>&rdquo; parameter from <strong>consultant request</strong> and using it in <strong>client request</strong></li>
<li>Parameter pollution by injection two <strong>timing</strong> values in <strong>client request</strong></li>
<li>Array based injection using <strong>timing value</strong> in <strong>client request</strong> i.e {&ldquo;timing[0]&rdquo;:2}</li>
<li>HTTP method tampering by changing POST to PUT</li>
<li>Booking two or more time slots of same consultant by playing multi-threaded <strong>client request</strong> (Race condition)</li>
<li>Booking two different consultant&rsquo;s time slots by playing multi-threaded <strong>client request</strong> (Race condition)</li>
</ol>

<p>I am sure, you might have come up with different test cases so please comment below your test cases.</p>

<p>Unfortunately, none of the above test cases worked for me üò•. May be their security team mitigated these vulnerabilities or experienced developers built the application.</p>

<p>Next day, I took a look again and this time my attention goes to more in booking request since there is no coin passed in the request and coins get automatically deducted from client&rsquo;s account after submitting the <strong>client request</strong>.</p>

<pre><code>POST /consultant_username/book
{&quot;timing&quot;:2}
</code></pre>

<p><strong>What will happen if consultant change fee to some higher amount just before client book the time slot</strong>. I was excited ü§© thought this should work but again it didn&rsquo;t work out for me. Since it showed the message &ldquo;Consultant&rsquo;s fee for this slot is 10&rdquo;.</p>

<p><img src="https://cdn-images-1.medium.com/max/1320/1*W7JE1YcyRLtdXm5G9zfpQg.png" alt="..." /></p>

<p>I was going to give up but the idea of <strong>race condition</strong> came into my mind, for testing it out I sent multi-threaded request to web server with four different consulting fee (5, 15, 15, 5) in four different requests at a time and put those requests in a loop for half an hour. When a client visits consultant timeline during this time period there are 50% chances that client will end up paying higher fee. This way, I was successfully able to exploit üòÑ this vulnerability by changing consulting price quickly. Application also has an offer features in which consultants can set discount for a certain period of time.</p>

<h2 id="attack-flow">Attack flow</h2>

<ol>
<li>Consultant set fee 5 coins for a time slot &lsquo;x&rsquo;.</li>
<li>Consultant set offer period i.e 30‚Äì60 minutes during a day.</li>
<li>Clients visit consultant timeline during offer period.</li>
<li>Consultant quickly change consulting price by playing multi-threaded <strong>consultant request</strong> in loop and send it to server.</li>
<li>Clients pay the fee by sending booking request to the server.</li>
<li>Extra coins get deducted from the clients account.</li>
</ol>

<h2 id="impact">Impact</h2>

<p>Consultants can trick clients in paying higher amount then shown in their timeline for their services.</p>

<h2 id="takeaway">Takeaway</h2>

<p>As a defender, make a checklist of vulnerabilities and test it for every feature implemented in the application. Rate limiting and race condition based locking system should be implemented for preventing these kind of vulnerabilities.</p>

<p>As application&rsquo;s functionalities grow, its complexity grows exponentially and more chances to miss some test cases during design, development or security testing phases of the application. Analyze application functionality by going through request history again and again, understand data flow in application etc. Spend your energy &amp; time in building smarter test cases that can break application&rsquo;s use case.</p>

<p>Thank you very much!</p>

<p>Learn, Build &amp; Break!</p>
</section>
    <footer>
      <hr>
      <div class="meta">
        <p class="categories">
            
              
              <a href="/categories/security">SECURITY</a>
            </p>
        <p class="tags">
          
            
              <a href="/tags/bugbounty">
                <span>#</span>bugbounty</a>
            
              <a href="/tags/race-conditon">
                <span>#</span>Race conditon</a>
            
          
        </p>
      </div>
      <hr>
      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "abhibundela" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </footer>
  </article>

    </main>
    <footer>
  <p>
    &copy; 2018 Abhishek Bundela.
  </p>
  <p>
    Powered by <a href="https://gohugo.io" title="A Fast and Flexible Website Generator">Hugo</a> &amp; <a href="https://github.com/eshlox/simplicity" title="Hugo theme">Simplicity</a>.
  </p>
</footer>

    <script src="/assets/js/main.82829af440c4.js"></script>
    
  </body>
</html>
